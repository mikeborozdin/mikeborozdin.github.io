---
layout: post
title: "High Quality Image Resizing with .NET"
comments: true
---
<p>I want to proceed with telling how to deal with uploaded images with ASP.NET. I have already showed how to resize images. However, that resizing method isn't perfect. It doesn't produce images of high quality. Even though it just shrinks images, the quality of resized images don't match the quality of original images, the produced quality usually appears to be worse. Sure, there is a neat solution. We just need to use the <strong>HighQualityB
<script src="http://www.mikeborozdin.com/editors/tiny_mce3/themes/advanced/langs/en.js" type="text/javascript"></script>
icubic</strong> <strong>Interpolation mode</strong>. Sounds difficult? In fact, it's not difficult to implement, just need to add a few lines of code,&nbsp; but the result is great. <!-- more --></p>
<p>Here are two images, the left is made with a simply resizing method, while the right one is made with a resizing method. Note, that it doesn't have noise on the buildings and the right image has the better contrast.</p>
<p><a href="/images/WindowsLiveWriter/HighQualityImageResizingwith.NET_C19F/low_2.jpg"><img style="border-top-width: 0px; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" src="/images/WindowsLiveWriter/HighQualityImageResizingwith.NET_C19F/low_thumb.jpg" border="0" alt="low" width="180" height="240" /></a> <a href="/images/WindowsLiveWriter/HighQualityImageResizingwith.NET_C19F/high_2.jpg"><img style="border-top-width: 0px; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" src="/images/WindowsLiveWriter/HighQualityImageResizingwith.NET_C19F/high_thumb.jpg" border="0" alt="high" width="180" height="240" /></a></p>
<p>The code is:</p>
<div>
<pre class="csharpcode"><span class="kwrd">private</span> Bitmap ResizeImage(Stream streamImage, <span class="kwrd">int</span> maxWidth, <span class="kwrd">int</span> maxHeight)
{
    Bitmap originalImage = <span class="kwrd">new</span> Bitmap(streamImage);
    <span class="kwrd">int</span> newWidth = originalImage.Width;
    <span class="kwrd">int</span> newHeight = originalImage.Height;
    <span class="kwrd">double</span> aspectRatio = (<span class="kwrd">double</span>)originalImage.Width / (<span class="kwrd">double</span>)originalImage.Height;

    <span class="kwrd">if</span> (aspectRatio &lt;= 1 &amp;&amp; originalImage.Width &gt; maxWidth)
    {
        newWidth = maxWidth;
        newHeight = (<span class="kwrd">int</span>)Math.Round(newWidth / aspectRatio);
    }
    <span class="kwrd">else</span> <span class="kwrd">if</span> (aspectRatio &gt; 1 &amp;&amp; originalImage.Height &gt; maxHeight)
    {
        newHeight = maxHeight;
        newWidth = (<span class="kwrd">int</span>)Math.Round(newHeight * aspectRatio);
    }

    Bitmap newImage = <span class="kwrd">new</span> Bitmap(originalImage, newWidth, newHeight);
    
    Graphics g = Graphics.FromImage(newImage);
    g.InterpolationMode = System.Drawing.Drawing2D.InterpolationMode.HighQualityBilinear;
    g.DrawImage(originalImage, 0, 0, newImage.Width, newImage.Height);

    originalImage.Dispose();
    
    <span class="kwrd">return</span> newImage;     
}</pre>
</div>
<p>You can read more on different interpolation mode <a href="http://msdn.microsoft.com/en-us/library/k0fsyd4e.aspx" target="_blank">here</a>.</p>
<p>You can also download the project files <a href="/files/HighQualityImageUploading.zip">here</a>, they include uploading and high quality resizing.</p>
