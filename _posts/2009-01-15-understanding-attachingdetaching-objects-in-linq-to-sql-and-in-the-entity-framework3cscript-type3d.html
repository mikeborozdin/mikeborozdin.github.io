---
layout: post
title: "Understanding Attaching/Detaching Objects in LINQ to SQL and in the Entity Framework"
comments: true
---
<p>LINQ to SQL and the Entity Framework are very powerful tools, however as in many other useful tools there are some things you should be aware of when working with them. One of those things is object attaching and detaching. Let&rsquo;s have a concrete example.</p>
<p>As you already know, you can retrieve an object from the database, update or remove it and all the necessary changes will be submitted to the database.</p>
<p>But what if you don&rsquo;t want to perform additional SELECT query? Instead, you want just to perform one necessary query, either to update an object or remove it. <!-- more --></p>
<p>Well, a quite logical idea is to create an object, set an appropriate ID attribute and then update/delete it:</p>
<div class="csharpcode">
<pre class="alt">NorthwindDataContext db = <span class="kwrd">new</span> NorthwindDataContext();</pre>
<pre>&nbsp;</pre>
<pre class="alt">Product product = <span class="kwrd">new</span> Product { ProductID = 1 };</pre>
<pre>&nbsp;</pre>
<pre class="alt">db.Products.DeleteOnSubmit(product);</pre>
<pre>&nbsp;</pre>
<pre class="alt">db.SubmitChanges();</pre>
</div>
<p><!-- .csharpcode, .csharpcode pre { 	font-size: small; 	color: black; 	font-family: consolas, "Courier New", courier, monospace; 	background-color: #ffffff; 	/*white-space: pre;*/ } .csharpcode pre { margin: 0em; } .csharpcode .rem { color: #008000; } .csharpcode .kwrd { color: #0000ff; } .csharpcode .str { color: #006080; } .csharpcode .op { color: #0000c0; } .csharpcode .preproc { color: #cc6633; } .csharpcode .asp { background-color: #ffff00; } .csharpcode .html { color: #800000; } .csharpcode .attr { color: #ff0000; } .csharpcode .alt  { 	background-color: #f4f4f4; 	width: 100%; 	margin: 0em; } .csharpcode .lnum { color: #606060; } --></p>
<p>&nbsp;</p>
<p>Okay, but it won&rsquo;t work. The code will gets compiled, but when executed it will throw an exception stating: &ldquo;<strong>Cannot remove an entity that has not been attached.</strong>&rdquo; Well, in fact, it&rsquo;s quite obvious, because the object context is simply unaware of that object, so let it know about the object. We just need to attach the object to the object context:</p>
<div class="csharpcode">
<pre class="alt">NorthwindDataContext db = <span class="kwrd">new</span> NorthwindDataContext();</pre>
<pre>&nbsp;</pre>
<pre class="alt">Product product = <span class="kwrd">new</span> Product { ProductID = 1 };</pre>
<pre>db.Products.Attach(product); <span class="rem">//that necessary line</span></pre>
<pre class="alt">&nbsp;</pre>
<pre>db.Products.DeleteOnSubmit(product);</pre>
<pre class="alt">&nbsp;</pre>
<pre>db.SubmitChanges();</pre>
</div>
<p><!-- .csharpcode, .csharpcode pre { 	font-size: small; 	color: black; 	font-family: consolas, "Courier New", courier, monospace; 	background-color: #ffffff; 	/*white-space: pre;*/ } .csharpcode pre { margin: 0em; } .csharpcode .rem { color: #008000; } .csharpcode .kwrd { color: #0000ff; } .csharpcode .str { color: #006080; } .csharpcode .op { color: #0000c0; } .csharpcode .preproc { color: #cc6633; } .csharpcode .asp { background-color: #ffff00; } .csharpcode .html { color: #800000; } .csharpcode .attr { color: #ff0000; } .csharpcode .alt  { 	background-color: #f4f4f4; 	width: 100%; 	margin: 0em; } .csharpcode .lnum { color: #606060; } --></p>
<p>So, if you compile it now, you will get no exceptions and the necessary product will be removed from the database. You can use the same technique when you need to update an object without having to retrieve it from the database and the same thing applies to the Entity Framework, although the code is slightly different:</p>
<pre class="csharpcode">NorthwindEntities db = <span class="kwrd">new</span> NorthwindEntities();

Product product = <span class="kwrd">new</span> Product { ProductID = 10 };
product.EntityKey = <span class="kwrd">new</span> EntityKey("NorthwindEntities.Products", "ProductID", 10);</pre>
<pre class="csharpcode">db.Attach(product);

db.DeleteObject(product);

db.SaveChanges();</pre>
<p><!-- .csharpcode, .csharpcode pre { 	font-size: small; 	color: black; 	font-family: consolas, "Courier New", courier, monospace; 	background-color: #ffffff; 	/*white-space: pre;*/ } .csharpcode pre { margin: 0em; } .csharpcode .rem { color: #008000; } .csharpcode .kwrd { color: #0000ff; } .csharpcode .str { color: #006080; } .csharpcode .op { color: #0000c0; } .csharpcode .preproc { color: #cc6633; } .csharpcode .asp { background-color: #ffff00; } .csharpcode .html { color: #800000; } .csharpcode .attr { color: #ff0000; } .csharpcode .alt  { 	background-color: #f4f4f4; 	width: 100%; 	margin: 0em; } .csharpcode .lnum { color: #606060; } --></p>
